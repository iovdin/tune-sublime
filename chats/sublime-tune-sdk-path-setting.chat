system: @@system
@claude-sonnet-4-5-20250929
user:
in tune_jsonrpc tune-sdk is called, i've hardcoded the path
i want you to set it to tune-sdk, and also create a sublime setting for tune-sdk-path
if tune-sdk is not found give a good error message on what to do
assistant:

tool_call: rf {"filename":"tune_jsonrpc.py","linenum":true}
tool_result:
@{ tune_jsonrpc.py | linenum }
assistant:

tool_call: rf {"filename":"tune.py","linenum":true}
tool_result:
@{ tune.py | linenum }
assistant:

tool_call: rf {"filename":"Chat.sublime-settings","linenum":true}
tool_result:
@{ Chat.sublime-settings | linenum }
assistant:
Now I'll make the necessary changes:

1. First, update the settings file to add the `tune-sdk-path` setting
2. Then update `tune_jsonrpc.py` to use the setting and provide a good error message
tool_call: wf {"filename":"Chat.sublime-settings"}
{
  // Syntax-specific settings for Chat files
  // These apply when View > Syntax is set to Chat
  // "color_scheme": "Packages/tune/color-schemes/Chat (Mariana).sublime-color-scheme"

  // Trigger autocomplete after typing '@' when using the Chat syntax
  /*
  "auto_complete_triggers": [
    { "characters": "@", "selector": "text.chat" },
    { "characters": "@", "selector": "text.prompt" }
  ]
  */

  // Path to the tune-sdk executable
  // If not set, will search in PATH
  // Examples:
  //   "tune-sdk-path": "tune-sdk"  (uses PATH)
  //   "tune-sdk-path": "/usr/local/bin/tune-sdk"  (absolute path)
  //   "tune-sdk-path": "~/.nvm/versions/node/v22.20.0/bin/tune-sdk"  (home relative)
  "tune-sdk-path": "tune-sdk"
}

tool_result:
written
assistant:

tool_call: patch {"filename":"tune_jsonrpc.py"}
<<<<<<< ORIGINAL
def spawn_tune(exports: Optional[Dict[str, Callable]] = None, cwd: Optional[str] = None):
    env_path = os.environ.get("TUNE_PATH", "")
    cmd = ["/Users/iovdin/.nvm/versions/node/v22.20.0/bin/tune-sdk", "rpc"]
    if env_path:
        cmd += ["--path", env_path]
    client = JsonRpcClient(cmd, exports=exports, cwd=cwd)
    err = client.start()
    if err:
        return None, err
    # advertise exports
    try:
        client.init(["resolve", "read"], False, lambda _e, _r: None)
    except Exception:
        pass
    return client, None
=======
def spawn_tune(exports: Optional[Dict[str, Callable]] = None, cwd: Optional[str] = None):
    import shutil
    
    # Try to get tune-sdk path from settings
    try:
        import sublime
        settings = sublime.load_settings("Chat.sublime-settings")
        tune_sdk_path = settings.get("tune-sdk-path", "tune-sdk")
    except Exception:
        tune_sdk_path = "tune-sdk"
    
    # Expand home directory if present
    if tune_sdk_path.startswith("~"):
        tune_sdk_path = os.path.expanduser(tune_sdk_path)
    
    # Check if tune-sdk exists
    if os.path.isabs(tune_sdk_path):
        # Absolute path - check directly
        if not os.path.isfile(tune_sdk_path):
            return None, (
                f"tune-sdk not found at '{tune_sdk_path}'\n\n"
                "Please install tune-sdk:\n"
                "  npm install -g @isaiahgrace/tune-sdk\n\n"
                "Then update the 'tune-sdk-path' setting in:\n"
                "  Preferences > Package Settings > tune > Settings\n"
                "or set it to 'tune-sdk' to use PATH."
            )
    else:
        # Relative path or command name - check in PATH
        if not shutil.which(tune_sdk_path):
            return None, (
                f"tune-sdk not found in PATH as '{tune_sdk_path}'\n\n"
                "Please install tune-sdk:\n"
                "  npm install -g @isaiahgrace/tune-sdk\n\n"
                "Or update the 'tune-sdk-path' setting in:\n"
                "  Preferences > Package Settings > tune > Settings\n"
                "to point to the full path of your tune-sdk executable."
            )
    
    env_path = os.environ.get("TUNE_PATH", "")
    cmd = [tune_sdk_path, "rpc"]
    if env_path:
        cmd += ["--path", env_path]
    client = JsonRpcClient(cmd, exports=exports, cwd=cwd)
    err = client.start()
    if err:
        return None, err
    # advertise exports
    try:
        client.init(["resolve", "read"], False, lambda _e, _r: None)
    except Exception:
        pass
    return client, None
>>>>>>> UPDATED
tool_result:
patched
assistant:
Perfect! I've made the necessary changes:

## Summary of Changes:

### 1. **Updated `Chat.sublime-settings`**:
   - Added a `tune-sdk-path` setting with a default value of `"tune-sdk"` (which will search in PATH)
   - Added helpful comments with examples for different path configurations (PATH, absolute path, home relative path)

### 2. **Updated `tune_jsonrpc.py`**:
   - Removed the hardcoded path `/Users/iovdin/.nvm/versions/node/v22.20.0/bin/tune-sdk`
   - Now reads the `tune-sdk-path` setting from `Chat.sublime-settings`
   - Falls back to `"tune-sdk"` if the setting can't be read
   - Expands `~` to the user's home directory if present in the path
   - Validates that the tune-sdk executable exists before trying to run it
   - Provides clear, helpful error messages if tune-sdk is not found:
     - Explains how to install it via npm
     - Shows where to configure the setting
     - Different messages for absolute paths vs PATH lookups

Now users can:
- Use the default `"tune-sdk"` to search in PATH
- Set an absolute path like `"/usr/local/bin/tune-sdk"`
- Use home-relative paths like `"~/.nvm/versions/node/v22.20.0/bin/tune-sdk"`

And if tune-sdk isn't found, they'll get a clear error message explaining exactly what to do!
